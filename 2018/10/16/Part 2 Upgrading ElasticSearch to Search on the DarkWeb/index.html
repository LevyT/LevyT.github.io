<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><meta name="author" content="Tomer Levy"><link rel="icon" href="/tomer.jpeg"><title>Information Security &amp; DevOps</title><meta name="description" content="Information Security &amp; Devops Blog"><link rel="alternate" type="application/rss+xml" title="Information Security &amp; DevOps" href="/atom.xml"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">Information Security &amp; DevOps</a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/archives">Archive</a></li><li><a href="/about/">About</a></li></ul></div><div class="avatar-container"><div class="avatar-img-border"><a href="/"><img src="/tomer.jpeg" class="avatar-img"></a></div></div></div></nav><header class="header-section"><div class="intro-header no-img"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><h1>Part 2 Upgrading ElasticSearch to Search on the DarkWeb</h1><p class="post-meta">Posted on Oct 16 2018 · <a href="/tags/DarkWeb/" class="tag post-meta">DarkWeb</a> · <a href="/tags/ElasticSearch/" class="tag post-meta">ElasticSearch</a> · <a href="/tags/Kibana/" class="tag post-meta">Kibana</a> · <a href="/tags/Scraping/" class="tag post-meta">Scraping</a></p></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role="main" class="blog-post"><p><strong>Continuing from the place I left</strong></p>
<p><img src="/images/Screenshot from 2018-10-16 19-57-02.png" alt=""></p>
<p>If you are not using the Nginx setup from the recent post Follow this:</p>
<p>go to /etc/kibana/kibana.yml and /etc/elasticsearch/elasticsearch.yml</p>
<p>and change the server.host and elasticsearch.url for Kibana and network.host for ElasticSearch to my ip address instead of localhost</p>
<p>restart both of them services,</p>
<p>Access to Kibana from the browser at the <a href="http://ipaddress:5601" target="_blank" rel="noopener">http://ipaddress:5601</a></p>
<p>Install git by: <code>sudo apt-get install git</code></p>
<p>Install essentials programs and parser:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential python-pip3 python-virtualenv</span><br><span class="line">sudo apt-get install libxml2-dev libxslt1-dev python-dev libffi-dev libssl-dev</span><br><span class="line">pip3 install bs4 requests</span><br></pre></td></tr></table></figure></p>
<p>Install elasticsearch ingest plugin:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/elasticsearch/bin/elasticsearch-plugin install https://oss.sonatype.org/content/repositories/releases/de/spinscale/elasticsearch/plugin/ingest/ingest-opennlp/5.1.2.1/ingest-opennlp-5.1.2.1.zip</span><br></pre></td></tr></table></figure></p>
<p>add these 3 lines if they don’t already exists to the end of /etc/elasticsearch/elasticsearch.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ingest.opennlp.model.file.persons: en-ner-persons.bin</span><br><span class="line">ingest.opennlp.model.file.dates: en-ner-dates.bin</span><br><span class="line">ingest.opennlp.model.file.locations: en-ner-locations.bin</span><br></pre></td></tr></table></figure></p>
<p>Clone Ahima-Index<br><code>git clone https://github.com/ahmia/ahmia-index</code><br><code>cd ahima-index</code><br>Set-Up ElasticSearch Mappings:</p>
<p><code>curl -XPUT -i &quot;ipaddress:9200/crawl&quot; -d &quot;@./mappings_tor.json&quot;</code></p>
<p><code>curl -X PUT ipaddress:9200/_ingest/pipeline/opennlp-pipeline -d &#39; {
&quot;description&quot;: &quot;A pipeline For Ahima&quot;,
&quot;processors&quot;: [ { &quot;opennlp&quot; : { &quot;field&quot; : &quot;content&quot;, &quot;ignore_missing&quot;:
true } } ] } &#39;</code></p>
<p>Install Tor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">You need to add the following entries to /etc/apt/sources.list or a new file in /etc/apt/sources.list.d/:</span><br><span class="line"></span><br><span class="line">deb https://deb.torproject.org/torproject.org xenial main</span><br><span class="line">deb-src https://deb.torproject.org/torproject.org xenial main</span><br><span class="line"></span><br><span class="line">Then add the gpg key used to sign the packages by running the following commands at your command prompt:</span><br><span class="line"></span><br><span class="line"> gpg2 --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89</span><br><span class="line"> gpg2 --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | apt-key add -</span><br><span class="line"></span><br><span class="line"> apt update</span><br><span class="line"> apt install tor deb.torproject.org-keyring</span><br></pre></td></tr></table></figure>
<p>Install Polipo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install polipo</span><br><span class="line">Edit /etc/polipo/config to look like this:</span><br><span class="line"></span><br><span class="line">logSyslog = true</span><br><span class="line">logFile = /var/log/polipo/polipo.log</span><br><span class="line"></span><br><span class="line">socksParentProxy = localhost:9050</span><br><span class="line">diskCacheRoot=&quot;&quot;</span><br><span class="line">disableLocalInterface=true</span><br></pre></td></tr></table></figure>
<p>Restart Them</p>
<p><code>sudo systemctl restart tor.service</code></p>
<p>&amp;</p>
<p><code>sudo systemctl restart polipo</code></p>
<p>Check that they work</p>
<p>curl –proxy localhost:8123 ‘icanhazip.com’</p>
<p>Get The Crawler:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ahmia/ahmia-crawler</span><br><span class="line">cd ahima-crawler</span><br><span class="line">virtualenv -p /usr/bin/python3 ./venv</span><br><span class="line">source venv/bin/activate</span><br><span class="line">pip3 install -r requirements/prod.txt</span><br></pre></td></tr></table></figure></p>
<p><del>~~Time for Fun</del>~~~</p>
<p>Run The Crawler </p>
<p>cd ahima</p>
<p><code>scrapy crawl ahmia-tor -s DEPTH_LIMIT=3 -s ROBOTSTXT_OBEY=0 -s FULL_PAGERANK_COMPUTE=True</code></p>
<p>And go to Kibana</p>
<p>And create index Pattern for that new index</p>
<p>Under Management</p>
<p><img src="/images/Screenshot from 2018-10-16 20-43-58.png" alt=""></p>
<p>Go to Kibana Discover and choose crawl* index.</p>
<p><img src="/images/Screenshot from 2018-09-11 15-06-00.png" alt=""></p>
</article><ul class="pager blog-pager"><li class="previous"><a href="/2018/10/19/Setting up Selenium for Python/" data-toggle="tooltip" data-placement="top" title="Browser Automation Selenium for Python">← Previous Post</a></li><li class="next"><a href="/2018/09/11/Installing ElasticSearch Kibanna on Ubuntu 16.04/" data-toggle="tooltip" data-placement="top" title="Part 1 Installing ElasticSearch Kibanna on Ubuntu 16.04">Next Post →</a></li></ul></div></div></div><footer><div class="container beautiful-jekyll-footer"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href="/atom.xml" title="RSS"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-rss"></i></span></a></li><li><a href="mailto:tl1996@gmail.com" title="Email me"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-envelope"></i></span></a></li><li><a href="https://www.linkedin.com/in/tomer-levy/" title="LinkedIn"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i><i class="fa fa-stack-1x fa-inverse fa-linkedin"></i></span></a></li></ul><p class="copyright text-muted">© Tomer Levy • 2019 • <a href="mailto:undefined"></a>
</p><p class="theme-by text-muted">Theme by
<a href="https://github.com/twoyao/beautiful-hexo">beautiful-hexo</a></p></div></div></div></footer><script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script><script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
    a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-124261609-1', 'auto');
ga('send', 'pageview');</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false}});</script></body></html>